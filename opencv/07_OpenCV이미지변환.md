---
layout: post
title: OpenCV 이미지 변환
subtitle: "특징 검출과 데이터 해석을 위한 이미지 전처리"
type: "OpenCV"
createDate: 2021-01-27
opcv: true
text: true
author: yoncho
post-header: false
header-img: ""
order: 7
---

# OpenCV에서 이미지 변환, 이미지 전처리 작업
이미지 변형이랑은 살짝 다른 변환은, 이미지 데이터 개수를 늘리거나 줄여서  
연산량을 줄이는 것을 목표로 한다.  
**변환**은 수학적으로 접근하면 (x, y)좌표값을 (x', y')값으로 변환하는 것을 의미한다.  
OpenCV에서 변환은 크게 **이미지의 크기 변환**, **특정 요소의 위치 변경**, **이미지의 회전** 등이 있다.  
유형으로는 강체 변환, 유사 변환, **선형 변환**, **아핀 변환**, 원근 변환이 있다.  

> - 강체 변환 : 평행이동과 회전 하는변환
> - 유사 변환 : 평행이동과 회전, 크기조절 하는 변환 
> - 선형 변환 : 크기조절, 반사, 기울임 하는 변환
> - 아핀 변환 : 크기조절, 반사, 기울임, 이동 하는 변환 (사각형을 평행사변형으로 바꾸는게 아핀 변환)
> - 원근 변환 : 아핀변환과 유사하지만, 수평성은 유지되지않는다. (직선의 성질만 유지하고, 임의의 사각형으로 변한다.)


## 1. 확대 & 축소
![pyramid_example](https://user-images.githubusercontent.com/44021629/106040547-f65a7000-611d-11eb-9ed4-c3a7d992d0fc.png)

입력 이미지는 크기가 다 다르다, 그러나 알고리즘에서 요구하는 이미지의 크기는 어느정도 정해져있는 상황이다.  
그러면 우리는 입력이미지의 크기를 줄여주거나 늘려줘야한다.  
이미지 확대와 축소는 **이미지 피라미드(image pyramid)**를 활용해 단계별로 이미지를 샘플링한다.  


![pyramid_example](https://user-images.githubusercontent.com/44021629/106041067-ac25be80-611e-11eb-9c0f-74e0ce183071.png)
> - 업샘플링(up sampling) : 원본 이미지에서 크기를 확대하는 것, 하위 단계 이미지 생성
> - 다운샘플링(down sampling) : 원본 이미지에서 크기를 축소하는 것, 상위 단계 이미지 생성

이미지 피라미드는 **가우시안 피라미드** , **라플라시안 피라미드**를 활용한다.  

### 가우시안 피라미드
하위단계의 이미지를 생성하는 업샘플링과  
상위단계의 이미지를 생성하는 다운샘플링을 사용한다.  
업샘플링은 입력 이미지에 새로운 행과 열을 추가해서 짝수행과 짝수열로 만든 후 하위단계 이미지를 만든다.  
즉, 입력 이미지가 M x N 사이즈라면 하위단계로 생성된 이미지의 크기는 2M x 2N이다.  
다운샘플리은 반대로 입력 이미지의 짝수행과 짝수열을 제거해서 상위단계 이미지를 만든다.  
즉, 입력 이미지가 M x N 사이즈라면 상위단계로 생성된 이미지의 크기는 M/2 x N/2이다.  
면적으로 따지면 업샘플링은 4배, 다운샘플리은 1/4배로 이미지가 변형된 것이다.  

잘 보면, 업샘플링은 입력 이미지에 새로운 행과 열 즉, 새로운 데이터를 추가하는 것이고  
다운샘플링은 입력 이미지에 있던 기존 데이터에서 짝수행과 짝수열을 제거하는 것이므로,,  
이미지를 업샘플링했다가 다운샘플링을 했다고 가정하면, 원본이미지와 결과이미지의 정보 데이터가 일치하지 않는다.  
이럴 경우를 대비해,, 다운샘플링시 제거된 정보를 갖고와서 본래의 이미지로 복원해야된다.

### 라플라시안 피라미드 
> G(0) = Image  
> G(i + 1) = Down(G(i))  
> L(i) = G(i) - Up(G(i + 1))
G(0)은 입력 이미지를 의미하며, G(i)는 i번째 가우시안 피라미드 이미지를 의미한다.  
G(i + 1)이미지를 만들기 위해 다운샘플링을 수행한다.  
L(i)는 가우시안 피라미드로 만든 G(i)에서 업샘플링된 G(i + 1)을 감산해  
**가우시안 피라미드 레이어 간의 차이**를 구한다.  

<hr>

<code>이미지확대 (업샘플링) 함수</code>

```js
dst = cv2.pyrUp(
  src,
  dstSize = None,
  borderType = None
)
```
> - src : 입력이미지
> - dstSize : 출력이미지의 크기, None이면 업샘플링을 한번 한다. 대부분 None으로 입력한다.
> - borderType : 테두리 외삽법, 대부분 None으로 입력한다.

이미지 확대 함수는 입력 이미지에 새로운 행과 열을 추가한 뒤 0값으로 할당해준다.  
이후 새로운 값을 할당하기위해서 근사값으로 채워 넣은 후, 가우시안 필터로 컨벌루션을 진행한다.  
여기서 가우시안 필터는 4의 값을 갖고 정규화한다.  

<code>이미지축소 (다운샘플링) 함수</code>

```js
dst = cv2.pyrDown(
  src,
  dstSize = None,
  borderType = None
)
```
> - src : 입력이미지
> - dstSize : 출력이미지의 크기, None이면 다운샘플링을 한번 한다. 대부분 None으로 입력한다.
> - borderType : 테두리 외삽법, 대부분 None으로 입력한다.

이미지 축소 함수는 이미지에 흐림 효과를 적용한 후 다운 샘플링을 진행한다.  


<code>이미지 축소 함수 예제</code>

```js
import cv2

src = cv2.imread("bear.jpg")
dst = src.copy()

for i in range(3):
  dst = cv2.pyrDown(dst)

cv2.imshow("dst", dst)
cv2.waitKey(0)
cv2.destroyAllWindows()
```

<hr>


## 2. 이미지 크기 조절





<hr>



<code>#영상처리 #이미지 변환</code>
